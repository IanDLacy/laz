<!doctype html>
<html>
  <head>
    <title>Socket.IO chat</title>
    <style>
      * { margin: 0; padding: 0; box-sizing: border-box; }
      body { font: 13px Helvetica, Arial; }
      form { background: #000; padding: 3px; position: fixed; bottom: 0; width: 100%; }
      form input { border: 0; padding: 10px; width: 90%; margin-right: .5%; }
      form button { width: 9%; background: rgb(130, 224, 255); border: none; padding: 10px; }
      #messages { list-style-type: none; margin: 0; padding: 0; }
      #messages li { padding: 5px 10px; }
      #messages li:nth-child(odd) { background: #eee; }
    </style>
  </head>
  <body>
    <button id="choose0" onclick="choose(0)">choose 0</button>
    <button id="choose1" onclick="choose(1)">choose 1</button>
    <button id="choose2" onclick="choose(2)">choose 2</button>
    <button id="choose3" onclick="choose(3)">choose 3</button>
    <button id="choose4" onclick="choose(4)">choose 4</button>
    <button id="choose5" onclick="choose(5)">choose 5</button>
    <button id="choose6" onclick="choose(6)">choose 6</button>
    <ul id="messages"></ul>
    <form action="">
      <input id="m" autocomplete="off" value="enter name" /><button id="submit" >Send</button>
    </form>
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://code.jquery.com/jquery-1.11.1.js"></script>
    <script>
      $(function () {
        var socket = io();
        $('#messages').append($('<li>').text("starting"))
        $('form').submit(function(e){
          e.preventDefault(); // prevents page reloading
          addPlayer($('#m').val());
          $('form').remove('#submit')
          return false;
        });
        const PASSWORD = "abc123"
        var MYTURN = false
        var whiteCards = []
        const newGame = () => {
            socket.emit("newGame", "mygame", "chris", (ngsucc) => {
                if (ngsucc) {
                    socket.emit("makePrivate", "mygame", "abc123", (mpsucc) => {
                        if (mpsucc) {
                            $('#messages').append($('<li>').text("made a private game"))
                        } else {$('#messages').append($('<li>').text("make private failed"))}
                    })
                } else { $('#messages').append($('<li>').text("newgame failed"))}
            })
        }
    
        const addPlayer = (name) =>{
            console.log("adding",name)
            socket.emit("joinGame", "mygame", name, (success) => {
                $('#messages').append($('<li>').text(`added: ${success}`))
            })
        }
    
        socket.on("requestPassword", (fn) => {
            $('#messages').append($('<li>').text("pw requested"));
            fn(PASSWORD)
        })
    
        socket.on("myTurn", () => {
            MYTURN = true
            $('#messages').append($('<li>').text("its my turn"));
        })
    
        socket.on("dealBlack", (card) => {
            $('#messages').append($('<li>').text(`black: ${card.text}`));
        })

        socket.on("dealWhite", (cards) => {
            $('#messages').append($('<li>').text("your cards:"));
            whiteCards.push(...cards)
            whiteCards.forEach(card => {
                $('#messages').append($('<li>').text(`black: ${card.text}`));
            });
        })
    
        socket.on("failure", ({message}) => {
            $('#messages').append($('<li>').text(`failure: ${message}`))
        })

        function choose(n){
            val = (MYTURN) ? "chooseWhiteCard" : "playWhiteCard"
            MYTURN = false
            console.log(val)
            socket.emit(val, whiteCards[n], (success) => {
                $('#messages').append($('<li>').text(`success: ${success}`))
            })
        }

        document.getElementById("choose0").onclick = () => choose(0)
        document.getElementById("choose1").onclick = () => choose(1)
        document.getElementById("choose2").onclick = () => choose(2)
        document.getElementById("choose3").onclick = () => choose(3)
        document.getElementById("choose4").onclick = () => choose(4)
        document.getElementById("choose5").onclick = () => choose(5)
        document.getElementById("choose6").onclick = () => choose(6)
    });
    </script>
  </body>
</html>